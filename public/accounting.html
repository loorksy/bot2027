<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุงููุญุงุณุจุฉ ุงููุจุณุท</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body style="margin: 0; background: #0f0f1a; color: #fff; font-family: 'Segoe UI', sans-serif;">

    <div style="max-width: 1200px; margin: 0 auto; padding: 20px;">

        <!-- DASHBOARD (CYCLES LIST) -->
        <div id="page-dashboard">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <h1>ุงูุฏูุฑุงุช ุงููุญุงุณุจูุฉ</h1>
                    <div id="safe-balance-badge"
                        style="background: #2e7d32; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 14px; display: none;">
                        ๐ฐ ุงูุฎุฒูุฉ: $0
                    </div>
                </div>
                <div>
                    <button class="btn btn-success" onclick="showTreasury()">๐ฐ ุงูุฎุฒููุฉ</button>
                    <a href="/transfer-companies.html" class="btn btn-info">๐ข ุดุฑูุงุช ุงูุชุญููู</a>
                    <button class="btn btn-warning" onclick="showAgencyWallets()">๐ฆ ุตูุงุฏูู ุงูููุงูุงุช</button>
                    <button class="btn btn-secondary" onclick="showSubAgencies()">๐ข ุงูููุงูุงุช ุงููุฑุนูุฉ</button>
                    <button class="btn btn-secondary" onclick="showMainAgency()">๐ค ุงูููุงูุฉ ุงูุฑุฆูุณูุฉ</button>
                    <button class="btn btn-primary" onclick="openCreateModal()">+ ุฏูุฑุฉ ุฌุฏูุฏุฉ</button>
                </div>
            </header>

            <div class="ai-card">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ุงุณู ุงูุฏูุฑุฉ</th>
                            <th>ุงูุชุงุฑูุฎ</th>
                            <th>ุงูุญุงูุฉ</th>
                            <th>ุฅุฌุฑุงุก</th>
                        </tr>
                    </thead>
                    <tbody id="cycles-list">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- DETAILS (REPORT VIEW) -->
        <div id="page-details" style="display: none;">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <button class="btn btn-secondary btn-sm" onclick="showDashboard()">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
                    <h2 id="detail-title" style="margin-top: 10px;">-</h2>
                </div>
            </header>

            <!-- Simple Tabs -->
            <div style="margin-bottom: 20px; border-bottom: 1px solid #333; display: flex; gap: 10px;">
                <button class="tab-btn active" onclick="switchTab('soulchill')" id="btn-soulchill">ุจูุงูุงุช ุงูุฅุฏุงุฑุฉ
                    (Soulchill)</button>
                <button class="tab-btn" onclick="switchTab('agent')" id="btn-agent">ุจูุงูุงุช ุงููููู (Agent)</button>
            </div>

            <!-- TAB 1: Soulchill Data -->
            <div id="tab-soulchill">
                <div class="ai-card">
                    <h3>ุชูุฑูุฑ ุงูุฅุฏุงุฑุฉ ุงููุณุชูุฑุฏ</h3>
                    <p class="muted">ููุง ุชุธูุฑ ุงูุจูุงูุงุช ุงููุณุชูุฑุฏุฉ ูู ุดูุช ุงูุฅุฏุงุฑุฉ (ุฃุฑุจุงุญ ุงูููุงูุฉ).</p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ุงููุณุชุฎุฏู</th>
                                <th>Agency Profit (W)</th>
                                <th>Week Bonus (Y)</th>
                                <th>Month Bonus (Z)</th>
                                <th>Total Profit</th>
                            </tr>
                        </thead>
                        <tbody id="list-soulchill">
                            <tr>
                                <td colspan="5" class="text-center muted">ูุง ุชูุฌุฏ ุจูุงูุงุช (ูุฑุฌู ุงูุฑูุน)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- TAB 2: Agent Data -->
            <div id="tab-agent" style="display: none;">
                <div class="ai-card">
                    <h3>ุชูุฑูุฑ ุงููููู ุงููุณุชูุฑุฏ</h3>
                    <p class="muted">ููุง ุชุธูุฑ ุงูุจูุงูุงุช ุงููุณุชูุฑุฏุฉ ูู ุดูุช ุงููููู (ุงูุฑูุงุชุจ + ูุณุจุฉ ุงูุชุญููู).</p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ุงููุณุชุฎุฏู</th>
                                <th>ุงูุฑุงุชุจ (Net)</th>
                                <th>ูุณุจุฉ ุงูุชุญููู (7%)</th>
                                <th>ุงูุฅุฌูุงูู</th>
                            </tr>
                        </thead>
                        <tbody id="list-agent">
                            <tr>
                                <td colspan="4" class="text-center muted">ูุง ุชูุฌุฏ ุจูุงูุงุช (ูุฑุฌู ุงูุฑูุน)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- PAGE: MAIN AGENCY USERS -->
        <div id="page-main-agency" style="display: none;">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <button class="btn btn-secondary btn-sm" onclick="showDashboard()">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
                    <h2 style="display:inline-block; margin:0 10px;">๐ค ูุณุชุฎุฏูู ุงูููุงูุฉ ุงูุฑุฆูุณูุฉ</h2>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <label style="font-size: 12px; color: #888;">ุนูููุฉ ุงูุชุณููู:</label>
                        <input type="number" id="main-salary-ratio" style="width: 60px;" value="7" min="0" max="100"
                            step="0.1">
                        <span style="color: #888;">%</span>
                        <button class="btn btn-primary btn-sm" onclick="saveMainAgencyConfig()">๐พ ุญูุธ</button>
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="openImportUsersModal(true, 'Main')">๐ ุงุณุชูุฑุงุฏ
                        (CSV)</button>
                    <button class="btn btn-primary btn-sm" onclick="openAddUserModal('Main')">+ ุฅุถุงูุฉ ูุณุชุฎุฏู</button>
                </div>
            </header>
            <div class="ai-card">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>ุงูุงุณู</th>
                            <th>ุงูุฏููุฉ</th>
                            <th>ุงููุงุชู</th>
                            <th>ุฅุฌุฑุงุกุงุช</th>
                        </tr>
                    </thead>
                    <tbody id="main-users-list"></tbody>
                </table>
            </div>
        </div>

        <!-- PAGE: TREASURY (Main Safe) -->
        <div id="page-treasury" style="display: none;">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <button class="btn btn-secondary btn-sm" onclick="showDashboard()">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
                    <h2 style="display:inline-block; margin:0 10px;">๐ฐ ุงูุฎุฒููุฉ ุงูุฑุฆูุณูุฉ</h2>
                </div>
            </header>

            <!-- Stats Cards -->
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                <div class="ai-card"
                    style="padding: 20px; text-align: center; background: linear-gradient(135deg, #1a472a 0%, #2e7d32 100%);">
                    <div style="font-size: 12px; color: #aaa;">ุฑุตูุฏ ุงูุฎุฒููุฉ</div>
                    <div id="treasury-balance" style="font-size: 28px; font-weight: bold;">$0</div>
                </div>
                <div class="ai-card" style="padding: 20px; text-align: center;">
                    <div style="font-size: 12px; color: #aaa;">ุฅุฌูุงูู ุงูุฏุฎู</div>
                    <div id="treasury-income" style="font-size: 24px; color: #4caf50;">$0</div>
                </div>
                <div class="ai-card" style="padding: 20px; text-align: center;">
                    <div style="font-size: 12px; color: #aaa;">ุฅุฌูุงูู ุงููุตุฑููุงุช</div>
                    <div id="treasury-expense" style="font-size: 24px; color: #f44336;">$0</div>
                </div>
                <div class="ai-card" style="padding: 20px; text-align: center;">
                    <div style="font-size: 12px; color: #aaa;">ุตุงูู ุงูุฑุจุญ</div>
                    <div id="treasury-profit" style="font-size: 24px; color: #2196f3;">$0</div>
                </div>
                <div class="ai-card" style="padding: 20px; text-align: center; cursor: pointer;"
                    onclick="showCustodyDetails()" title="ุงุถุบุท ูุนุฑุถ ุงูุชูุงุตูู">
                    <div style="font-size: 12px; color: #aaa;">ุฅุฌูุงูู ุงูุฃูุงูุงุช ๐๏ธ</div>
                    <div id="treasury-custody" style="font-size: 24px; color: #ff9800;">$0</div>
                    <div style="font-size: 10px; color: #666; margin-top: 5px;">ุงููุณุชุฎุฏููู ุงูุฐูู ูู ูุณุชูููุง</div>
                </div>
            </div>

            <!-- Profit Sources Breakdown -->
            <div class="ai-card" style="padding: 20px; margin-bottom: 25px;">
                <h3 style="margin-bottom: 15px;">๐ ูุตุงุฏุฑ ุงูุฑุจุญ</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
                    <div style="background: #1a3a4a; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 11px; color: #888;">ููุณููู ุงูุชุณููู</div>
                        <div id="profit-commission" style="font-size: 20px; color: #4caf50;">$0</div>
                        <div style="font-size: 10px; color: #666;">ูู ุฑูุงุชุจ ุงููุณุฌููู</div>
                    </div>
                    <div style="background: #1a3a4a; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 11px; color: #888;">ูุณุจุฉ ุงูุฅุฏุงุฑุฉ ูู ุงููุฑุนู</div>
                        <div id="profit-cycle-income" style="font-size: 20px; color: #2196f3;">$0</div>
                        <div style="font-size: 10px; color: #666;">ูู ุฃุฑุจุงุญ ุงูููุงูุงุช ุงููุฑุนูุฉ</div>
                    </div>
                    <div style="background: #1a3a4a; padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 11px; color: #888;">ุฑุจุญ ุงูููุงูุงุช ุงููุฑุนูุฉ</div>
                        <div id="profit-sub-agency" style="font-size: 20px; color: #ff5722;">$0</div>
                        <div style="font-size: 10px; color: #666;">ูุณุชุญู ููููุงูุงุช</div>
                    </div>
                    <div
                        style="background: linear-gradient(135deg, #1a472a 0%, #2e7d32 100%); padding: 15px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 11px; color: #ccc;">ุตุงูู ุงูุฑุจุญ</div>
                        <div id="profit-net-total" style="font-size: 24px; font-weight: bold; color: #fff;">$0</div>
                        <div style="font-size: 10px; color: #aaa;">ุฅุฌูุงูู ุฃุฑุจุงุญ ุงูููุงูุฉ ุงูุฑุฆูุณูุฉ</div>
                    </div>
                </div>
            </div>

            <!-- Transactions Table -->
            <div class="ai-card">
                <h3 style="margin-bottom: 15px;">๐ ุณุฌู ุงููุนุงููุงุช</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ุงูุชุงุฑูุฎ</th>
                            <th>ุงูููุน</th>
                            <th>ุงููุฆุฉ</th>
                            <th>ุงููุจูุบ</th>
                            <th>ุงููุตู</th>
                        </tr>
                    </thead>
                    <tbody id="treasury-transactions"></tbody>
                </table>
            </div>
        </div>

        <!-- PAGE: AGENCY WALLETS -->
        <div id="page-agency-wallets" style="display: none;">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <button class="btn btn-secondary btn-sm" onclick="showDashboard()">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
                    <h2 style="display:inline-block; margin:0 10px;">๐ฆ ุตูุงุฏูู ุงูููุงูุงุช</h2>
                </div>
            </header>

            <div id="agency-wallets-grid"
                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- PAGE: AGENCY WALLET DETAIL -->
        <div id="page-wallet-detail" style="display: none;">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <button class="btn btn-secondary btn-sm" onclick="showAgencyWallets()">ุงูุนูุฏุฉ ูุตูุงุฏูู
                        ุงูููุงูุงุช</button>
                    <h2 id="wallet-detail-name" style="display:inline-block; margin:0 10px;">๐ฆ ุตูุฏูู ุงูููุงูุฉ</h2>
                </div>
                <div>
                    <button class="btn btn-warning btn-sm" onclick="openWithdrawModal()">๐ธ ุณุญุจ ูู ุงูุตูุฏูู</button>
                </div>
            </header>

            <!-- Wallet Stats -->
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px;">
                <div class="ai-card"
                    style="padding: 20px; text-align: center; background: linear-gradient(135deg, #1a1a4a 0%, #3949ab 100%);">
                    <div style="font-size: 12px; color: #aaa;">ุงูุฑุตูุฏ ุงูุญุงูู</div>
                    <div id="wallet-balance" style="font-size: 28px; font-weight: bold;">$0</div>
                </div>
                <div class="ai-card" style="padding: 20px; text-align: center;">
                    <div style="font-size: 12px; color: #aaa;">ุฅุฌูุงูู ุงููุงุฑุฏ</div>
                    <div id="wallet-in" style="font-size: 22px; color: #4caf50;">$0</div>
                </div>
                <div class="ai-card" style="padding: 20px; text-align: center;">
                    <div style="font-size: 12px; color: #aaa;">ุฅุฌูุงูู ุงููุณุญูุจ</div>
                    <div id="wallet-out" style="font-size: 22px; color: #f44336;">$0</div>
                </div>
            </div>

            <!-- Wallet Transactions -->
            <div class="ai-card">
                <h3 style="margin-bottom: 15px;">๐ ุณุฌู ุงููุนุงููุงุช</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ุงูุชุงุฑูุฎ</th>
                            <th>ุงูููุน</th>
                            <th>ุงููุจูุบ</th>
                            <th>ุงููุตู</th>
                        </tr>
                    </thead>
                    <tbody id="wallet-transactions"></tbody>
                </table>
            </div>
        </div>

        <!-- MODAL: WITHDRAW -->
        <div id="modal-withdraw" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 400px;">
                <h2>๐ธ ุณุญุจ ูู ุงูุตูุฏูู</h2>
                <div class="form-group">
                    <label>ุงููุจูุบ ($)</label>
                    <input type="number" id="inp-withdraw-amount" min="1" step="0.01"
                        style="width: 100%; padding: 10px;">
                </div>
                <div class="form-group">
                    <label>ููุงุญุธุงุช (ุงุฎุชูุงุฑู)</label>
                    <input type="text" id="inp-withdraw-note" placeholder="ุณุจุจ ุงูุณุญุจ..."
                        style="width: 100%; padding: 10px;">
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="closeWithdrawModal()">ุฅูุบุงุก</button>
                    <button class="btn btn-warning" onclick="processWithdraw()">๐ธ ุณุญุจ</button>
                </div>
            </div>
        </div>

        <!-- PAGE: UNKNOWN USERS (ูุฌููู) -->
        <div id="page-unknown-users" style="display: none;">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <button class="btn btn-secondary btn-sm" onclick="showAgencyWallets()">ุงูุนูุฏุฉ ูุตูุงุฏูู
                        ุงูููุงูุงุช</button>
                    <h2 style="display:inline-block; margin:0 10px;">โ ุงููุณุชุฎุฏููู ุงููุฌููููู</h2>
                </div>
            </header>

            <!-- Stats Cards -->
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                <div class="ai-card"
                    style="padding: 20px; text-align: center; background: linear-gradient(135deg, #4a1a1a 0%, #8b0000 100%);">
                    <div style="font-size: 12px; color: #ccc;">ุนุฏุฏ ุงููุฌููููู</div>
                    <div id="unknown-count" style="font-size: 28px; font-weight: bold;">0</div>
                </div>
                <div class="ai-card" style="padding: 20px; text-align: center;">
                    <div style="font-size: 12px; color: #aaa;">ุฅุฌูุงูู ุงูุฃูุงูุงุช</div>
                    <div id="unknown-custody" style="font-size: 24px; color: #ff9800;">$0</div>
                </div>
                <div class="ai-card" style="padding: 20px; text-align: center;">
                    <div style="font-size: 12px; color: #aaa;">ุฅุฌูุงูู ุงูููุณููู</div>
                    <div id="unknown-commission" style="font-size: 24px; color: #4caf50;">$0</div>
                </div>
            </div>

            <!-- Period Selector -->
            <div class="ai-card" style="padding: 15px; margin-bottom: 20px;">
                <label>ุงุฎุชุฑ ุงูุฏูุฑุฉ: </label>
                <select id="sel-unknown-period" onchange="loadUnknownUsers()" style="padding: 8px; min-width: 200px;">
                    <option value="">-- ุงุฎุชุฑ ุฏูุฑุฉ --</option>
                </select>
            </div>

            <!-- Users Table -->
            <div class="ai-card">
                <h3 style="margin-bottom: 15px;">๐ ูุงุฆูุฉ ุงููุณุชุฎุฏููู ุงููุฌููููู</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>ุฑูู ุงููุณุชุฎุฏู</th>
                            <th>ุงูุงุณู</th>
                            <th>ุงูุฑุงุชุจ</th>
                            <th>ุงูููุณููู</th>
                            <th>ุงูุฃูุงูุฉ</th>
                        </tr>
                    </thead>
                    <tbody id="unknown-users-list"></tbody>
                </table>
            </div>
        </div>

        <!-- PAGE: SUB-AGENCIES GRID -->
        <div id="page-sub-agencies" style="display: none;">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <button class="btn btn-secondary btn-sm" onclick="showDashboard()">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
                    <h2 style="display:inline-block; margin:0 10px;">๐ข ุงูููุงูุงุช ุงููุฑุนูุฉ</h2>
                </div>
                <div>
                    <button class="btn btn-secondary" onclick="downloadUsersTemplate()">๐ฅ ุชุญููู ุงููุงูุจ</button>
                    <button class="btn btn-primary" onclick="openAddAgencyModal()">+ ุฅุถุงูุฉ ููุงูุฉ ุฌุฏูุฏุฉ</button>
                </div>
            </header>

            <div id="agencies-grid"
                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
                <!-- JS Populated Cards -->
            </div>
        </div>

        <!-- PAGE: AGENCY PROFILE (DETAILS) -->
        <div id="page-agency-profile" style="display: none;">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button class="btn btn-secondary btn-sm" onclick="showSubAgencies()">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
                    <h2 id="profile-agency-name" style="display:inline-block; margin:0 10px;">Agency Name</h2>
                    <button class="btn btn-secondary btn-sm" onclick="openRenameAgencyModal()">โ๏ธ ุชุบููุฑ ุงูุงุณู</button>
                    <span id="agency-status-badge"
                        style="padding: 4px 10px; border-radius: 5px; font-size: 12px;">ููุนููุฉ</span>
                </div>
                <div>
                    <button id="btn-toggle-agency" class="btn btn-secondary btn-sm" onclick="toggleAgencyActive()">โธ๏ธ
                        ุฅููุงู ุงูููุงูุฉ</button>
                </div>
            </header>

            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <!-- Card 1: Stats -->
                <div class="ai-card" style="padding: 15px;">
                    <strong style="display: block; color: #888; font-size: 12px;">ุนุฏุฏ ุงููุณุชุฎุฏููู</strong>
                    <span id="profile-user-count" style="font-size: 24px;">0</span>
                </div>

                <!-- Card 2: Mgmt Ratio -->
                <div class="ai-card" style="padding: 15px;">
                    <strong style="display: block; color: #888; font-size: 12px;">ูุณุจุฉ ุงูุฅุฏุงุฑุฉ ูู ุงูุฑุจุญ (Management
                        %)</strong>
                    <div style="display: flex; align-items: center; gap: 5px; margin-top: 5px;">
                        <input type="number" id="inp-mgmt-ratio" value="10" min="0" max="100" style="width: 60px;"> %
                        <button class="btn btn-secondary btn-sm" onclick="saveAgencyConfig()">๐พ ุญูุธ </button>
                    </div>
                </div>

                <!-- Card 3: Salary Ratio -->
                <div class="ai-card" style="padding: 15px;">
                    <strong style="display: block; color: #888; font-size: 12px;">ุนูููุฉ ุชุญููู ุงูุฑูุงุชุจ (Salary
                        %)</strong>
                    <div style="display: flex; align-items: center; gap: 5px; margin-top: 5px;">
                        <input type="number" id="inp-salary-ratio" value="7" min="0" max="100" style="width: 60px;"> %
                        <button class="btn btn-secondary btn-sm" onclick="saveAgencyConfig()">๐พ ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
                    </div>
                </div>
            </div>

            <div class="ai-card">
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <h3>ุงููุณุชุฎุฏููู</h3>
                    <div>
                        <button class="btn btn-secondary btn-sm" onclick="openBulkIdImportModal()">๐ ุงุณุชูุฑุงุฏ ูู
                            ุงูุดูุช</button>
                        <button class="btn btn-secondary btn-sm" onclick="openImportUsersModal(true, currentAgency)">๐
                            ุงุณุชูุฑุงุฏ (CSV)</button>
                        <button class="btn btn-primary btn-sm" onclick="openAddUserModal(currentAgency)">+ ุฅุถุงูุฉ
                            ูุณุชุฎุฏู</button>
                    </div>
                </div>

                <!-- Search Box -->
                <div style="margin-bottom: 15px;">
                    <input type="text" id="inp-users-search" placeholder="๐ ุจุญุซ ุจุงูุงุณู ุฃู ID..."
                        style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #444; background: #1a1a2e; color: #fff;"
                        oninput="filterUsersTable()">
                </div>

                <div style="overflow-x: auto;">
                    <table class="data-table" style="min-width: 2000px;">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ุงูุงุณู</th>
                                <th>ุงูุฌูุณ</th>
                                <th>ุงูุบุฑูุฉ</th>
                                <th>ุงูููุงูุฉ</th>
                                <th>ุงูุฏู ุงูููุงูุฉ</th>
                                <th>ุงูููุทูุฉ</th>
                                <th>ุงูุฏููุฉ</th>
                                <th>ุชุงุฑูุฎ ุงูุชุณุฌูู</th>
                                <th>ุญุณุงุจ ุขุฎุฑ</th>
                                <th>ุงูุณุงุนุงุช</th>
                                <th>ุงูุฐูุจ ุงููุณุชูู</th>
                                <th>ุฐูุจ ุงูุดูุฑ ุงููุงุถู</th>
                                <th>ุฐูุจ ุงููุณุจุฉ</th>
                                <th>ุงูุชุงุฑูุช</th>
                                <th>ุงููุณุชูู ุงูุณุงุจู</th>
                                <th>ุงููุณุชูู</th>
                                <th>ุฑุงุชุจ ุงูุชุงุฑูุช</th>
                                <th>ููุงูุขุช ุงูุฃูุดุทุฉ</th>
                                <th>ููุงูุฃุฉ ุฃูู ุฃุณุจูุน</th>
                                <th>ุงูููุงูุขุช ุงูุดูุฑูุฉ</th>
                                <th>ุฅุฌูุงูู ุงูุฑุงุชุจ</th>
                                <th>ุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody id="profile-users-list"></tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div id="users-pagination"
                    style="display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 15px;">
                    <button class="btn btn-secondary btn-sm" onclick="prevUsersPage()">ยซ ุงูุณุงุจู</button>
                    <span id="page-info">ุตูุญุฉ 1 ูู 1</span>
                    <button class="btn btn-secondary btn-sm" onclick="nextUsersPage()">ุงูุชุงูู ยป</button>
                </div>
            </div>
        </div>

    </div>

    <!-- MODAL: Add Agency -->
    <div id="modal-add-agency" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <h3>ุฅุถุงูุฉ ููุงูุฉ ูุฑุนูุฉ</h3>
            <div class="form-group">
                <label>ุงุณู ุงูููุงูุฉ</label>
                <input type="text" id="inp-agency-name">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('modal-add-agency')">ุฅูุบุงุก</button>
                <button class="btn btn-primary" onclick="addAgency()">ุฅุถุงูุฉ</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Add User -->
    <div id="modal-add-user" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <h3>ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ</h3>
            <div class="form-group">
                <label>ID (ุฑูู ุงููุณุชุฎุฏู)</label>
                <input type="text" id="inp-user-id" placeholder="ูุซุงู: 123456">
            </div>
            <div class="form-group">
                <label>ุงูุงุณู ุงููุงูู</label>
                <input type="text" id="inp-user-name">
            </div>
            <div class="form-group">
                <label>ุงูููุงูุฉ (ูููู ูุชุบููุฑูุง ูููู ุงููุณุชุฎุฏู)</label>
                <input type="text" id="inp-user-agency" placeholder="Main, Soulchill, etc...">
            </div>
            <div class="form-group">
                <label>ูุนูููุงุช ุฅุถุงููุฉ (ุงูุฏููุฉ)</label>
                <input type="text" id="inp-user-country">
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('modal-add-user')">ุฅูุบุงุก</button>
                <button id="btn-save-user" class="btn btn-primary" onclick="addUser()">ุญูุธ</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Create Cycle (Existing) -->
    <div id="modal-create" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>ุฅูุดุงุก ุฏูุฑุฉ ุฌุฏูุฏุฉ</h2>

            <div class="form-group">
                <label>ุงุณู ุงูุฏูุฑุฉ (ูุซุงู: JAN-2026-WK1)</label>
                <input type="text" id="inp-name" style="width: 100%; padding: 10px;">
            </div>

            <div style="margin: 20px 0; background: #222; padding: 15px; border-radius: 5px;">
                <div class="form-group">
                    <label>ุฑูุน ุดูุช ุงูุฅุฏุงุฑุฉ (Soulchill):</label>
                    <input type="file" id="file-soulchill" accept=".csv">
                </div>
                <div class="form-group" style="margin-top: 10px;">
                    <label>ุฑูุน ุดูุช ุงููููู (Agent):</label>
                    <input type="file" id="file-agent" accept=".csv">
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">ุฅูุบุงุก</button>
                <button class="btn btn-primary" onclick="createCycle()">ุฅูุดุงุก ูุฑูุน</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Import Users -->
    <div id="modal-import-users" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <h2>ุงุณุชูุฑุงุฏ ูุงุนุฏุฉ ุจูุงูุงุช ุงููุณุชุฎุฏููู</h2>
            <div class="form-group">
                <label>ููู ุงููุณุชุฎุฏููู (CSV)</label>
                <input type="file" id="file-users-db" accept=".csv">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModalUsers()">ุฅูุบุงุก</button>
                <button class="btn btn-primary" onclick="importUsers()">ุฑูุน ูุชุญุฏูุซ</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Bulk ID Import from Sheet -->
    <div id="modal-bulk-import" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <h2>๐ ุงุณุชูุฑุงุฏ ูุณุชุฎุฏููู ูู ุดูุช ุงูุฅุฏุงุฑุฉ</h2>
            <p style="color: #aaa; margin-bottom: 15px;">ุงุฎุชุฑ ุงูุฏูุฑุฉ ุซู ุงูุตู ูุงุฆูุฉ ุงูู IDs ุงููุทููุจุฉ</p>

            <div class="form-group">
                <label>๐ ุงุฎุชุฑ ุงูุฏูุฑุฉ</label>
                <select id="sel-bulk-period" style="width: 100%; padding: 8px;">
                    <option value="">ุฌุงุฑู ุงูุชุญููู...</option>
                </select>
            </div>

            <div class="form-group" style="margin-top: 10px;">
                <label>๐ข ูุงุฆูุฉ ุงูู IDs ุงููุทููุจ ุงุณุชูุฑุงุฏูุง (ูู ID ูู ุณุทุฑ ูููุตู)</label>
                <textarea id="inp-bulk-ids" rows="8" placeholder="12345678
23456789
34567890" style="width: 100%; padding: 10px; font-family: monospace;"></textarea>
            </div>

            <div class="form-group" style="margin-top: 10px;">
                <label>ุงูููุงูุฉ ุงููุณุชูุฏูุฉ</label>
                <input type="text" id="inp-bulk-agency" value="" style="padding: 8px; width: 100%;" readonly>
            </div>

            <div class="modal-actions" style="margin-top: 15px;">
                <button class="btn btn-secondary" onclick="closeBulkImportModal()">ุฅูุบุงุก</button>
                <button class="btn btn-primary" onclick="processBulkImport()">๐ ุงุณุชูุฑุงุฏ</button>
            </div>
        </div>
    </div>

    <!-- Modal: Custody Details -->
    <div id="modal-custody-details" class="modal">
        <div class="modal-content" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>๐ฆ ุชูุงุตูู ุงูุฃูุงูุงุช</h3>
                <span class="modal-close" onclick="closeCustodyDetailsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p class="muted" style="margin-bottom: 15px;">ุงููุณุชุฎุฏููู ุงูุฐูู ูู ูุณุชูููุง ุฑูุงุชุจูู ุจุนุฏ (ุญุณุจ ุงูููุงูุฉ)</p>

                <div style="background: #1a1a1a; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="font-size: 12px; color: #aaa;">ุฅุฌูุงูู ุงูุฃูุงูุงุช</div>
                    <div id="custody-total" style="font-size: 28px; font-weight: bold; color: #ff9800;">$0</div>
                    <div id="custody-period" style="font-size: 11px; color: #666; margin-top: 5px;"></div>
                </div>

                <div id="custody-by-agency"></div>
            </div>
        </div>
    </div>

    <script src="accounting.js"></script>
</body>

</html>
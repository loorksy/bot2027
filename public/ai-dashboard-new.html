<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>لوحة التحكم - AI Agent</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #09090b;
      --surface: #18181b;
      --surface-2: #27272a;
      --border: #27272a;
      --primary: #10b981;
      --primary-dim: rgba(16, 185, 129, 0.1);
      --text: #e4e4e7;
      --text-muted: #a1a1aa;
      --text-dim: #71717a;
      --success: #059669;
      --success-bg: rgba(5, 150, 105, 0.15);
      --danger: #ef4444;
      --danger-bg: rgba(239, 68, 68, 0.1);
      --warning: #f59e0b;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'IBM Plex Sans Arabic', sans-serif;
      background: var(--bg);
      color: var(--text);
      font-size: 13px;
      line-height: 1.5;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    /* === LAYOUT === */
    .app-layout {
      display: flex;
      min-height: 100vh;
    }

    /* === SIDEBAR (Desktop) === */
    .sidebar {
      width: 240px;
      background: var(--surface);
      border-left: 1px solid var(--border);
      position: fixed;
      right: 0;
      top: 0;
      bottom: 0;
      z-index: 100;
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease;
    }

    @media (max-width: 768px) {
      .sidebar { display: none; }
    }

    .sidebar-header {
      padding: 16px;
      border-bottom: 1px solid var(--border);
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: var(--primary-dim);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
    }

    .logo-text {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
    }

    .logo-subtitle {
      font-size: 10px;
      color: var(--text-dim);
    }

    .sidebar-nav {
      flex: 1;
      padding: 12px 8px;
      overflow-y: auto;
    }

    .nav-section {
      margin-bottom: 16px;
    }

    .nav-section-title {
      font-size: 10px;
      font-weight: 600;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 0 12px;
      margin-bottom: 6px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      color: var(--text-muted);
      transition: all 0.2s;
      margin-bottom: 2px;
    }

    .nav-item:hover {
      background: var(--surface-2);
      color: var(--text);
    }

    .nav-item.active {
      background: var(--primary-dim);
      color: var(--primary);
    }

    .nav-item svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    .nav-item-text {
      font-size: 12px;
      font-weight: 500;
    }

    .nav-badge {
      margin-right: auto;
      background: var(--danger);
      color: white;
      font-size: 10px;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 10px;
      min-width: 18px;
      text-align: center;
    }

    /* === MAIN CONTENT === */
    .main-content {
      flex: 1;
      margin-right: 240px;
      padding: 20px;
      padding-bottom: 80px;
      min-height: 100vh;
    }

    @media (max-width: 768px) {
      .main-content {
        margin-right: 0;
        padding: 16px;
        padding-bottom: 80px;
      }
    }

    /* === BOTTOM NAV (Mobile) === */
    .bottom-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(24, 24, 27, 0.95);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-top: 1px solid var(--border);
      padding: 8px 0;
      padding-bottom: max(8px, env(safe-area-inset-bottom));
      z-index: 100;
    }

    @media (max-width: 768px) {
      .bottom-nav { display: flex; justify-content: space-around; }
    }

    .bottom-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 6px 12px;
      border: none;
      background: none;
      color: var(--text-dim);
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
      position: relative;
    }

    .bottom-nav-item svg {
      width: 20px;
      height: 20px;
    }

    .bottom-nav-item span {
      font-size: 10px;
      font-weight: 500;
    }

    .bottom-nav-item.active {
      color: var(--primary);
    }

    .bottom-nav-item .mobile-badge {
      position: absolute;
      top: 2px;
      right: 8px;
      background: var(--danger);
      color: white;
      font-size: 9px;
      font-weight: 600;
      padding: 1px 4px;
      border-radius: 8px;
      min-width: 14px;
    }

    /* === TAB CONTENT === */
    .tab-content {
      display: none;
      animation: fadeIn 0.2s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* === PAGE HEADER === */
    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .page-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .page-title svg {
      width: 20px;
      height: 20px;
      color: var(--primary);
    }

    .page-subtitle {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* === CARDS === */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }

    .card-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title svg {
      width: 16px;
      height: 16px;
      color: var(--primary);
    }

    /* === FORM ELEMENTS === */
    .form-group {
      margin-bottom: 14px;
    }

    .form-label {
      display: block;
      font-size: 11px;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .form-input, .form-select, .form-textarea {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 12px;
      color: var(--text);
      font-family: inherit;
      font-size: 12px;
      outline: none;
      transition: all 0.2s;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      border-color: var(--primary);
    }

    .form-textarea {
      min-height: 80px;
      resize: vertical;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }

    .form-switch {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .switch {
      position: relative;
      width: 40px;
      height: 22px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .switch-slider {
      position: absolute;
      cursor: pointer;
      inset: 0;
      background: var(--surface-2);
      border-radius: 22px;
      transition: 0.3s;
    }

    .switch-slider::before {
      content: '';
      position: absolute;
      height: 16px;
      width: 16px;
      right: 3px;
      bottom: 3px;
      background: var(--text-muted);
      border-radius: 50%;
      transition: 0.3s;
    }

    .switch input:checked + .switch-slider {
      background: var(--primary);
    }

    .switch input:checked + .switch-slider::before {
      transform: translateX(-18px);
      background: white;
    }

    /* === BUTTONS === */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-family: inherit;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn svg {
      width: 14px;
      height: 14px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: #0d9668;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--surface-2);
      color: var(--text);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    .btn-danger {
      background: var(--danger-bg);
      color: var(--danger);
    }

    .btn-danger:hover {
      background: var(--danger);
      color: white;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 11px;
    }

    .btn-icon {
      padding: 8px;
      border-radius: 8px;
    }

    /* === TABLE === */
    .table-container {
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    .data-table th,
    .data-table td {
      padding: 12px;
      text-align: right;
      border-bottom: 1px solid var(--border);
    }

    .data-table th {
      background: var(--bg);
      font-weight: 600;
      color: var(--text-muted);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .data-table tbody tr {
      transition: background 0.2s;
    }

    .data-table tbody tr:hover {
      background: var(--surface-2);
    }

    .data-table tbody tr:last-child td {
      border-bottom: none;
    }

    /* Mobile cards for table */
    @media (max-width: 768px) {
      .table-container { display: none; }
      .mobile-cards { display: block; }
    }

    @media (min-width: 769px) {
      .mobile-cards { display: none; }
    }

    .mobile-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 10px;
    }

    .mobile-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .mobile-card-title {
      font-weight: 600;
      color: var(--text);
    }

    .mobile-card-row {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px solid var(--border);
      font-size: 11px;
    }

    .mobile-card-row:last-child {
      border-bottom: none;
    }

    .mobile-card-label {
      color: var(--text-muted);
    }

    .mobile-card-value {
      color: var(--text);
      font-weight: 500;
    }

    .mobile-card-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    /* === BADGES === */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 10px;
      font-weight: 600;
    }

    .badge-success {
      background: var(--success-bg);
      color: var(--success);
    }

    .badge-warning {
      background: rgba(245, 158, 11, 0.15);
      color: var(--warning);
    }

    .badge-danger {
      background: var(--danger-bg);
      color: var(--danger);
    }

    .badge-info {
      background: var(--primary-dim);
      color: var(--primary);
    }

    /* === STATS GRID === */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px;
      text-align: center;
    }

    .stat-value {
      font-size: 22px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 10px;
      color: var(--text-muted);
    }

    /* === FILE UPLOAD === */
    .file-upload-area {
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .file-upload-area:hover,
    .file-upload-area.dragover {
      border-color: var(--primary);
      background: var(--primary-dim);
    }

    .file-upload-icon {
      width: 40px;
      height: 40px;
      margin: 0 auto 12px;
      color: var(--text-muted);
    }

    .file-upload-text {
      font-size: 12px;
      color: var(--text-muted);
    }

    .file-upload-hint {
      font-size: 10px;
      color: var(--text-dim);
      margin-top: 6px;
    }

    /* === CHAT === */
    .chat-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .chat-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      border-bottom: 1px solid var(--border);
    }

    .chat-item:hover {
      background: var(--surface-2);
    }

    .chat-item.unread {
      background: var(--primary-dim);
    }

    .chat-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--surface-2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      flex-shrink: 0;
    }

    .chat-info {
      flex: 1;
      min-width: 0;
    }

    .chat-name {
      font-weight: 600;
      font-size: 12px;
      color: var(--text);
    }

    .chat-preview {
      font-size: 11px;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .chat-time {
      font-size: 10px;
      color: var(--text-dim);
    }

    .chat-messages-container {
      height: 300px;
      overflow-y: auto;
      padding: 12px;
      background: var(--bg);
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .chat-bubble {
      max-width: 80%;
      padding: 10px 14px;
      border-radius: 12px;
      margin-bottom: 8px;
      font-size: 12px;
    }

    .chat-bubble.admin {
      background: var(--primary);
      color: white;
      margin-left: auto;
      border-bottom-left-radius: 4px;
    }

    .chat-bubble.client {
      background: var(--surface-2);
      color: var(--text);
      border-bottom-right-radius: 4px;
    }

    .chat-bubble-time {
      font-size: 9px;
      opacity: 0.7;
      margin-top: 4px;
    }

    /* === ALERT === */
    .alert-container {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      max-width: 90%;
    }

    .alert {
      background: var(--surface);
      border: 1px solid var(--border);
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 12px;
      animation: slideDown 0.3s ease;
    }

    .alert-success {
      border-color: var(--success);
      background: var(--success-bg);
    }

    .alert-error {
      border-color: var(--danger);
      background: var(--danger-bg);
    }

    @keyframes slideDown {
      from { transform: translate(-50%, -100%); opacity: 0; }
      to { transform: translate(-50%, 0); opacity: 1; }
    }

    /* === MODAL === */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    @media (max-width: 768px) {
      .modal {
        align-items: flex-end;
        padding: 0;
      }
    }

    .modal-content {
      background: var(--surface);
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      border-radius: 16px;
      overflow: hidden;
      animation: modalIn 0.3s ease;
    }

    @media (max-width: 768px) {
      .modal-content {
        max-width: 100%;
        border-radius: 20px 20px 0 0;
        max-height: 85vh;
      }
    }

    @keyframes modalIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
    }

    .modal-title {
      font-size: 14px;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 4px;
    }

    .modal-body {
      padding: 20px;
      overflow-y: auto;
      max-height: calc(90vh - 120px);
    }

    .modal-footer {
      padding: 16px 20px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    /* === EMPTY STATE === */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-muted);
    }

    .empty-state svg {
      width: 48px;
      height: 48px;
      color: var(--text-dim);
      margin-bottom: 12px;
    }

    .empty-state p {
      font-size: 12px;
    }

    /* === SEARCH === */
    .search-box {
      position: relative;
      margin-bottom: 16px;
    }

    .search-box input {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 12px 10px 36px;
      color: var(--text);
      font-size: 12px;
    }

    .search-box svg {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      color: var(--text-dim);
    }

    /* === PERIOD CARD === */
    .period-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .period-card.current {
      border-color: var(--primary);
      background: var(--primary-dim);
    }

    .period-info h4 {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .period-meta {
      font-size: 10px;
      color: var(--text-muted);
    }

    /* === TABS INSIDE CARDS === */
    .inner-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 16px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 12px;
    }

    .inner-tab {
      padding: 8px 14px;
      border: none;
      background: none;
      color: var(--text-muted);
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .inner-tab:hover {
      background: var(--surface-2);
    }

    .inner-tab.active {
      background: var(--primary-dim);
      color: var(--primary);
    }

    /* === DROPDOWN OPTIONS === */
    .dropdown-option {
      display: flex;
      gap: 8px;
      align-items: center;
      padding: 8px;
      background: var(--bg);
      border-radius: 6px;
      margin-bottom: 6px;
    }

    .dropdown-option input {
      flex: 1;
    }

    /* === KNOWLEDGE BASE === */
    .knowledge-item {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
    }

    .knowledge-item.inactive {
      opacity: 0.5;
    }

    .knowledge-question {
      font-weight: 600;
      font-size: 12px;
      margin-bottom: 6px;
    }

    .knowledge-answer {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* === TICKETS === */
    .ticket-item {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 10px;
    }

    .ticket-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .ticket-subject {
      font-weight: 600;
      font-size: 13px;
    }

    .ticket-message {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 10px;
      padding: 10px;
      background: var(--surface);
      border-radius: 6px;
    }

    /* === HIDDEN CLASS === */
    .hidden {
      display: none !important;
    }

    /* === SCROLLBAR === */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--surface-2);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-dim);
    }

    /* === MENU DRAWER (Mobile) === */
    .menu-drawer {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      z-index: 150;
      display: none;
    }

    .menu-drawer.active {
      display: block;
    }

    .menu-drawer-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--surface);
      border-radius: 20px 20px 0 0;
      padding: 20px;
      max-height: 70vh;
      overflow-y: auto;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }

    .menu-drawer-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      border-radius: 10px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
    }

    .menu-drawer-item:hover,
    .menu-drawer-item.active {
      background: var(--primary-dim);
      color: var(--primary);
    }

    .menu-drawer-item svg {
      width: 20px;
      height: 20px;
    }
  </style>
</head>
<body>
  <div id="alertContainer" class="alert-container"></div>

  <div class="app-layout">
    <!-- Sidebar (Desktop) -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="logo-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/>
            </svg>
          </div>
          <div>
            <div class="logo-text">AI Agent</div>
            <div class="logo-subtitle">لوحة التحكم</div>
          </div>
        </div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">الإعدادات</div>
          <div class="nav-item active" data-tab="settings">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
            <span class="nav-item-text">إعدادات AI</span>
          </div>
          <div class="nav-item" data-tab="fields">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>
            <span class="nav-item-text">الحقول المخصصة</span>
          </div>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">إدارة العملاء</div>
          <div class="nav-item" data-tab="registered">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            <span class="nav-item-text">العملاء المسجلين</span>
          </div>
          <div class="nav-item" data-tab="linked">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
            <span class="nav-item-text">العملاء المربوطين</span>
          </div>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">المالية</div>
          <div class="nav-item" data-tab="salary">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
            <span class="nav-item-text">الرواتب</span>
          </div>
          <div class="nav-item" data-tab="notifications">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
            <span class="nav-item-text">الإشعارات</span>
          </div>
          <div class="nav-item" data-tab="chats">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
            <span class="nav-item-text">الدردشات</span>
            <span id="chatsBadge" class="nav-badge hidden">0</span>
          </div>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">الدعم</div>
          <div class="nav-item" data-tab="tickets">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/></svg>
            <span class="nav-item-text">التذاكر</span>
            <span id="ticketsBadge" class="nav-badge hidden">0</span>
          </div>
          <div class="nav-item" data-tab="knowledge">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
            <span class="nav-item-text">قاعدة المعرفة</span>
          </div>
          <div class="nav-item" data-tab="usage">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>
            <span class="nav-item-text">الاستهلاك</span>
          </div>
        </div>
      </nav>

      <div style="padding: 12px; border-top: 1px solid var(--border);">
        <a href="/" style="display: flex; align-items: center; gap: 8px; color: var(--text-muted); text-decoration: none; font-size: 11px; padding: 10px; border-radius: 8px; transition: all 0.2s;" onmouseover="this.style.background='var(--surface-2)'" onmouseout="this.style.background='transparent'">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          العودة للرئيسية
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Settings Tab -->
      <div id="settings" class="tab-content active" data-testid="settings-tab">
        <div class="page-header">
          <div>
            <div class="page-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
              إعدادات AI
            </div>
            <div class="page-subtitle">تحكم في إعدادات الذكاء الاصطناعي والبوت</div>
          </div>
          <button class="btn btn-primary" id="saveSettingsBtn" data-testid="save-settings-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
            حفظ الإعدادات
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/></svg>
              الذكاء الاصطناعي
            </div>
            <div class="form-switch">
              <label class="switch">
                <input type="checkbox" id="aiEnabled">
                <span class="switch-slider"></span>
              </label>
              <span style="font-size: 11px; color: var(--text-muted);">تفعيل AI Agent</span>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">مزود الذكاء الاصطناعي</label>
              <select class="form-select" id="aiProvider">
                <option value="openai">OpenAI</option>
                <option value="openrouter">OpenRouter</option>
              </select>
            </div>
          </div>

          <div id="openaiSettings">
            <div class="form-group">
              <label class="form-label">OpenAI API Key</label>
              <input type="password" class="form-input" id="openaiKey" placeholder="sk-..." data-testid="openai-key">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">موديل المحادثة (Chat)</label>
                <select class="form-select" id="modelChat">
                  <option value="gpt-4o-mini">GPT-4o Mini (أرخص)</option>
                  <option value="gpt-4o">GPT-4o</option>
                  <option value="gpt-4-turbo">GPT-4 Turbo</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">موديل تحويل الصوت لنص (STT)</label>
                <select class="form-select" id="modelStt">
                  <option value="whisper-1">Whisper-1</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">موديل تحويل النص لصوت (TTS)</label>
                <select class="form-select" id="modelTts">
                  <option value="tts-1">TTS-1 (سريع)</option>
                  <option value="tts-1-hd">TTS-1-HD (جودة عالية)</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">صوت TTS</label>
                <select class="form-select" id="voiceTts">
                  <option value="alloy">Alloy</option>
                  <option value="echo">Echo</option>
                  <option value="fable">Fable</option>
                  <option value="onyx">Onyx</option>
                  <option value="nova">Nova</option>
                  <option value="shimmer">Shimmer</option>
                </select>
              </div>
            </div>
          </div>

          <div id="openrouterSettings" class="hidden">
            <div class="form-group">
              <label class="form-label">OpenRouter API Key</label>
              <input type="password" class="form-input" id="openrouterKey" placeholder="sk-or-..." data-testid="openrouter-key">
            </div>
            <div class="form-group">
              <label class="form-label">موديل OpenRouter</label>
              <select class="form-select" id="openrouterModel">
                <option value="openai/gpt-4o-mini">OpenAI GPT-4o Mini</option>
              </select>
              <button class="btn btn-sm btn-secondary" style="margin-top: 8px;" onclick="loadOpenRouterModels()">
                تحميل الموديلات المتاحة
              </button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></svg>
              شخصية البوت
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">اسم البوت</label>
              <input type="text" class="form-input" id="botName" value="مساعد أبو سلطان" data-testid="bot-name">
            </div>
            <div class="form-group">
              <label class="form-label">اسم المالك</label>
              <input type="text" class="form-input" id="ownerName" value="أبو سلطان" data-testid="owner-name">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">اللهجة</label>
              <select class="form-select" id="dialect">
                <option value="سورية">سورية</option>
                <option value="لبنانية">لبنانية</option>
                <option value="مصرية">مصرية</option>
                <option value="خليجية">خليجية</option>
                <option value="فصحى">فصحى</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">جنس العميل الافتراضي</label>
              <select class="form-select" id="clientGender">
                <option value="مؤنث">مؤنث</option>
                <option value="مذكر">مذكر</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">مستوى الودية</label>
              <select class="form-select" id="friendliness">
                <option value="عالي">عالي (صديقة)</option>
                <option value="متوسط">متوسط (مهنية)</option>
                <option value="منخفض">منخفض (رسمية)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">عملة الراتب</label>
              <input type="text" class="form-input" id="salaryCurrency" value="ر.س" data-testid="salary-currency">
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">رسالة التواصل مع الإدارة</label>
            <input type="text" class="form-input" id="adminContact" value="تواصلي مع الإدارة">
          </div>

          <div class="form-switch" style="margin-top: 12px;">
            <label class="switch">
              <input type="checkbox" id="enableVoiceReplies">
              <span class="switch-slider"></span>
            </label>
            <span style="font-size: 11px; color: var(--text-muted);">تفعيل الردود الصوتية</span>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              إعدادات الجلسة
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">مدة الجلسة الموثوقة (دقائق)</label>
              <input type="number" class="form-input" id="trustedSessionMinutes" value="15">
            </div>
            <div class="form-group">
              <label class="form-label">نسبة الوكالة الافتراضية (%)</label>
              <input type="number" class="form-input" id="agencyPercent" value="0" step="0.1">
            </div>
          </div>
        </div>
      </div>

      <!-- Custom Fields Tab -->
      <div id="fields" class="tab-content" data-testid="fields-tab">
        <div class="page-header">
          <div>
            <div class="page-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>
              الحقول المخصصة
            </div>
            <div class="page-subtitle">أضف حقول إضافية لبيانات العملاء</div>
          </div>
          <button class="btn btn-secondary" id="refreshFieldsBtn">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
            تحديث
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">إضافة حقل جديد</div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">اسم الحقل</label>
              <input type="text" class="form-input" id="fieldName" placeholder="مثال: رقم الحساب">
            </div>
            <div class="form-group">
              <label class="form-label">نوع الحقل</label>
              <select class="form-select" id="fieldType">
                <option value="text">نص</option>
                <option value="number">رقم</option>
                <option value="dropdown">قائمة منسدلة</option>
              </select>
            </div>
          </div>

          <div id="dropdownOptionsContainer" class="hidden">
            <label class="form-label">خيارات القائمة</label>
            <div id="dropdownOptions"></div>
            <button type="button" class="btn btn-sm btn-secondary" style="margin-top: 8px;" onclick="addDropdownOptionInputWithSubField()">+ إضافة خيار</button>
          </div>

          <div style="display: flex; gap: 10px; margin-top: 16px;">
            <button class="btn btn-primary" id="addFieldBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
              إضافة الحقل
            </button>
            <button class="btn btn-secondary hidden" id="cancelEditFieldBtn" onclick="cancelEdit()">إلغاء التعديل</button>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">الحقول الحالية</div>
          </div>
          <div id="fieldsList"></div>
        </div>
      </div>

      <!-- Registered Clients Tab -->
      <div id="registered" class="tab-content" data-testid="registered-tab">
        <div class="page-header">
          <div>
            <div class="page-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              العملاء المسجلين
            </div>
            <div class="page-subtitle">إدارة بيانات العملاء</div>
          </div>
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <button class="btn btn-secondary" id="refreshRegClientsBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
              تحديث
            </button>
            <button class="btn btn-primary" id="addRegClientBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></svg>
              إضافة عميل
            </button>
          </div>
        </div>

        <div class="search-box">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
          <input type="text" id="searchRegClientInput" placeholder="بحث بالاسم أو ID أو الهاتف..." data-testid="search-clients">
        </div>

        <div class="stats-grid" id="clientsStats"></div>

        <div class="table-container">
          <table class="data-table" id="registeredClientsTable">
            <thead>
              <tr>
                <th>الاسم</th>
                <th>IDs</th>
                <th>الهاتف</th>
                <th>الوكالة</th>
                <th>إجراءات</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="mobile-cards" id="registeredClientsMobile"></div>
      </div>

      <!-- Linked Clients Tab -->
      <div id="linked" class="tab-content" data-testid="linked-tab">
        <div class="page-header">
          <div>
            <div class="page-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
              العملاء المربوطين
            </div>
            <div class="page-subtitle">العملاء المتصلين عبر واتساب</div>
          </div>
          <button class="btn btn-secondary" id="refreshLinkedClientsBtn">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
            تحديث
          </button>
        </div>

        <div class="table-container">
          <table class="data-table" id="linkedClientsTable">
            <thead>
              <tr>
                <th>رقم واتساب</th>
                <th>الاسم</th>
                <th>الحالة</th>
                <th>آخر تواصل</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="mobile-cards" id="linkedClientsMobile"></div>
      </div>

      <!-- Salary Tab -->
      <div id="salary" class="tab-content" data-testid="salary-tab">
        <div class="page-header">
          <div>
            <div class="page-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
              إدارة الرواتب
            </div>
            <div class="page-subtitle">رفع وإدارة ملفات الرواتب</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">رفع ملف رواتب جديد</div>
          </div>

          <div class="file-upload-area" id="fileUploadArea">
            <input type="file" id="salaryFile" accept=".csv,.xlsx,.xls" style="display: none;">
            <svg class="file-upload-icon" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/>
            </svg>
            <div class="file-upload-text">اضغط أو اسحب الملف هنا</div>
            <div class="file-upload-hint">CSV, Excel (حد أقصى 10MB)</div>
          </div>

          <div id="uploadPreview" class="hidden" style="margin-top: 16px;">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">اسم الفترة</label>
                <input type="text" class="form-input" id="periodName" placeholder="مثال: يناير 2026">
              </div>
              <div class="form-group">
                <label class="form-label">نسبة الخصم (%)</label>
                <input type="number" class="form-input" id="uploadAgencyPercent" value="0" step="0.1">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">عمود ID</label>
                <select class="form-select" id="idColumn"></select>
              </div>
              <div class="form-group">
                <label class="form-label">عمود الراتب</label>
                <select class="form-select" id="salaryColumn"></select>
              </div>
            </div>
            <div id="previewTable" style="margin: 16px 0; max-height: 200px; overflow: auto;"></div>
            <div style="display: flex; gap: 10px;">
              <button class="btn btn-primary" id="uploadBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 16 12 12 8 16"/><line x1="12" x2="12" y1="12" y2="21"/><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/></svg>
                رفع الملف
              </button>
              <button class="btn btn-secondary" id="cancelUploadBtn">إلغاء</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">فترات الرواتب</div>
          </div>
          <div id="periodsList"></div>
        </div>
      </div>

      <!-- Notifications Tab -->
      <div id="notifications" class="tab-content" data-testid="notifications-tab">
        <div class="page-header">
          <div>
            <div class="page-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
              الإشعارات
            </div>
            <div class="page-subtitle">إرسال إشعارات للعملاء</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">إرسال إشعار جديد</div>
          </div>
          <form id="notificationForm">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">العنوان</label>
                <input type="text" class="form-input" id="notifTitle" placeholder="عنوان الإشعار" required>
              </div>
              <div class="form-group">
                <label class="form-label">النوع</label>
                <select class="form-select" id="notifType">
                  <option value="info">معلومات</option>
                  <option value="success">نجاح</option>
                  <option value="warning">تحذير</option>
                  <option value="celebration">احتفال</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">الرسالة</label>
              <textarea class="form-textarea" id="notifMessage" placeholder="نص الإشعار..." required></textarea>
            </div>
            <div class="form-group">
              <label class="form-label">الفئة المستهدفة</label>
              <select class="form-select" id="notifTarget">
                <option value="all">جميع العملاء</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m22 2-7 20-4-9-9-4Z"/></svg>
              إرسال الإشعار
            </button>
          </form>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">الإشعارات المرسلة</div>
          </div>
          <div id="notificationsList"></div>
        </div>
      </div>

      <!-- Chats Tab -->
      <div id="chats" class="tab-content" data-testid="chats-tab">
        <div class="page-header">
          <div>
            <div class="page-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
              الدردشات الحية
            </div>
            <div class="page-subtitle">تواصل مباشر مع العملاء</div>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 16px;">
          <div class="card" style="margin-bottom: 0;">
            <div class="card-header">
              <div class="card-title">المحادثات</div>
            </div>
            <div class="chat-list" id="chatsList"></div>
          </div>

          <div class="card" style="margin-bottom: 0;">
            <div class="card-header">
              <div class="card-title" id="currentChatTitle">اختر محادثة</div>
            </div>
            <div class="chat-messages-container" id="chatMessagesContainer"></div>
            <div style="display: flex; gap: 8px;">
              <input type="text" class="form-input" id="adminChatInput" placeholder="اكتب رسالتك..." style="flex: 1;">
              <button class="btn btn-primary" onclick="sendAdminChatMessage()">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m22 2-7 20-4-9-9-4Z"/></svg>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tickets Tab -->
      <div id="tickets" class="tab-content" data-testid="tickets-tab">
        <div class="page-header">
          <div>
            <div class="page-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/></svg>
              تذاكر الدعم
            </div>
            <div class="page-subtitle">طلبات ومشاكل العملاء</div>
          </div>
        </div>

        <div class="stats-grid" id="ticketsStats"></div>
        <div id="ticketsList"></div>
      </div>

      <!-- Knowledge Tab -->
      <div id="knowledge" class="tab-content" data-testid="knowledge-tab">
        <div class="page-header">
          <div>
            <div class="page-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
              قاعدة المعرفة
            </div>
            <div class="page-subtitle">أسئلة شائعة وإجابات جاهزة</div>
          </div>
          <button class="btn btn-danger btn-sm" onclick="resetKnowledge()">
            إعادة تعيين
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">إضافة سؤال جديد</div>
          </div>
          <form id="knowledgeForm">
            <div class="form-group">
              <label class="form-label">السؤال</label>
              <input type="text" class="form-input" id="kbQuestion" placeholder="مثال: كيف أعرف راتبي؟" required>
            </div>
            <div class="form-group">
              <label class="form-label">الإجابة</label>
              <textarea class="form-textarea" id="kbAnswer" placeholder="الإجابة..." required></textarea>
            </div>
            <div class="form-group">
              <label class="form-label">كلمات مفتاحية (مفصولة بفاصلة)</label>
              <input type="text" class="form-input" id="kbKeywords" placeholder="راتب, معاش, فلوس">
            </div>
            <button type="submit" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
              إضافة
            </button>
          </form>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">الأسئلة الحالية</div>
          </div>
          <div id="knowledgeList"></div>
        </div>
      </div>

      <!-- Usage Tab -->
      <div id="usage" class="tab-content" data-testid="usage-tab">
        <div class="page-header">
          <div>
            <div class="page-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>
              الاستهلاك
            </div>
            <div class="page-subtitle">إحصائيات استخدام AI</div>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-secondary" id="refreshUsageBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
              تحديث
            </button>
            <button class="btn btn-danger btn-sm" id="resetUsageBtn">إعادة تعيين</button>
          </div>
        </div>

        <div class="stats-grid" id="usageStats"></div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">سجل الاستخدام</div>
          </div>
          <div class="table-container">
            <table class="data-table" id="usageTable">
              <thead>
                <tr>
                  <th>التاريخ</th>
                  <th>النوع</th>
                  <th>التوكنات</th>
                  <th>التكلفة</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Bottom Navigation (Mobile) -->
  <nav class="bottom-nav">
    <button class="bottom-nav-item active" data-tab="settings">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
      <span>إعدادات</span>
    </button>
    <button class="bottom-nav-item" data-tab="registered">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      <span>العملاء</span>
    </button>
    <button class="bottom-nav-item" data-tab="chats">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
      <span>الدردشات</span>
      <span id="mobileChatsBadge" class="mobile-badge hidden">0</span>
    </button>
    <button class="bottom-nav-item" onclick="openMenuDrawer()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
      <span>المزيد</span>
    </button>
  </nav>

  <!-- Menu Drawer (Mobile) -->
  <div class="menu-drawer" id="menuDrawer" onclick="closeMenuDrawer()">
    <div class="menu-drawer-content" onclick="event.stopPropagation()">
      <div class="menu-drawer-item" data-tab="salary">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
        الرواتب
      </div>
      <div class="menu-drawer-item" data-tab="notifications">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
        الإشعارات
      </div>
      <div class="menu-drawer-item" data-tab="tickets">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/></svg>
        التذاكر
      </div>
      <div class="menu-drawer-item" data-tab="knowledge">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
        قاعدة المعرفة
      </div>
      <div class="menu-drawer-item" data-tab="fields">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/></svg>
        الحقول المخصصة
      </div>
      <div class="menu-drawer-item" data-tab="linked">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
        العملاء المربوطين
      </div>
      <div class="menu-drawer-item" data-tab="usage">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>
        الاستهلاك
      </div>
    </div>
  </div>

  <!-- Client Modal -->
  <div class="modal" id="clientModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="clientModalTitle">إضافة عميل</div>
        <button class="modal-close" onclick="closeClientModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="clientForm">
          <input type="hidden" id="editingClientKey">
          <div class="form-group">
            <label class="form-label">الاسم الكامل *</label>
            <input type="text" class="form-input" id="regFullName" required data-testid="client-name">
          </div>
          <div class="form-group">
            <label class="form-label">أرقام ID (مفصولة بفاصلة) *</label>
            <input type="text" class="form-input" id="regIds" placeholder="123456, 789012" required data-testid="client-ids">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">الهاتف</label>
              <input type="tel" class="form-input" id="regPhone" data-testid="client-phone">
            </div>
            <div class="form-group">
              <label class="form-label">واتساب</label>
              <input type="tel" class="form-input" id="regWhatsapp" data-testid="client-whatsapp">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">الدولة</label>
              <select class="form-select" id="regCountry"></select>
            </div>
            <div class="form-group">
              <label class="form-label">المدينة</label>
              <select class="form-select" id="regCity"></select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">العنوان</label>
            <input type="text" class="form-input" id="regAddress">
          </div>
          <div class="form-group">
            <label class="form-label">الوكالة</label>
            <select class="form-select" id="regAgency"></select>
          </div>
          <div id="customFieldsContainer"></div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeClientModal()">إلغاء</button>
        <button class="btn btn-secondary" id="clearRegFormBtn">مسح</button>
        <button class="btn btn-primary" id="saveClientBtn">حفظ</button>
      </div>
    </div>
  </div>

  <!-- Notify Modal -->
  <div class="modal" id="notifyModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">إرسال إشعار</div>
        <button class="modal-close" onclick="closeNotifyModal()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <p id="notifyClientInfo" style="font-size: 12px; color: var(--text-muted); margin-bottom: 16px;"></p>
        <div class="inner-tabs">
          <button class="inner-tab active" onclick="toggleNotifyType('salary')">إشعار الراتب</button>
          <button class="inner-tab" onclick="toggleNotifyType('custom')">رسالة مخصصة</button>
        </div>
        <div id="notifyCustomContainer" class="hidden">
          <div class="form-group">
            <label class="form-label">الرسالة</label>
            <textarea class="form-textarea" id="notifyCustomMessage" placeholder="اكتب رسالتك هنا..."></textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeNotifyModal()">إلغاء</button>
        <button class="btn btn-primary" onclick="sendNotification()">إرسال</button>
      </div>
    </div>
  </div>

